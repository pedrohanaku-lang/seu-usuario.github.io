<!DOCTYPE html>
<html>
<head>
    <title>TIME ZUEIRA - SAMURAI EDITION</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; }
        #overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #0ff; }
        button { background: #0ff; color: #000; border: none; padding: 20px 40px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        #debug { position: absolute; bottom: 10; left: 10; color: red; font-size: 10px; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 style="text-shadow: 0 0 10px #0ff;">TIME ZUEIRA RPG</h1>
    <p>[W,A,S,D] Move | [SHIFT] Dash | [ESPAÇO] Ataca | [E] Fala</p>
    <button id="startBtn">INICIALIZAR SISTEMA</button>
</div>
<div id="debug"></div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const overlay = document.getElementById("overlay");
const debug = document.getElementById("debug");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- SISTEMA DE CARREGAMENTO SEGURO ---
const sprites = {};
const assets = {
    hero: "_Hugkw.gif",
    master: "XSuwrQ.gif",
    ninja: "Ru5PS2.gif",
    mago: "KFBLh9.gif",
    enemy: "sRNxiP.gif",
    logo: "image_da46a4.png"
};

let loadedCount = 0;
const totalAssets = Object.keys(assets).length;

Object.entries(assets).forEach(([key, src]) => {
    const img = new Image();
    img.src = src;
    img.onload = () => { loadedCount++; sprites[key] = img; };
    img.onerror = () => { 
        loadedCount++; 
        debug.innerHTML += `Erro ao carregar: ${src}<br>`;
        // Cria um fallback (quadrado colorido) se a imagem sumir
        const canvasFallback = document.createElement("canvas");
        canvasFallback.width = 32; canvasFallback.height = 32;
        const ctxF = canvasFallback.getContext("2d");
        ctxF.fillStyle = key === 'enemy' ? 'red' : 'blue';
        ctxF.fillRect(0,0,32,32);
        sprites[key] = canvasFallback;
    };
});

// --- ESTADO DO JOGO ---
let gameStarted = false;
const p = { 
    x: 200, y: 300, w: 50, h: 50, 
    speed: 5, dash: 0, 
    weaponLvl: 0, // 0: Fraco, 1: VMZ
    dir: 1, 
    isAttacking: 0 
};

const boss = { x: 700, y: 300, hp: 100, alive: true, size: 80 };
const keys = {};

// NPCs com posições fixas
const npcs = [
    { x: 400, y: 150, id: 'mestre', color: '#ff0', msg: "Aperte [E] para a Lâmina VMZ!" },
    { x: 150, y: 500, id: 'ninja', color: '#0f0', msg: "O Dash [SHIFT] te deixa invencível." }
];

// --- CONTROLES ---
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

startBtn.onclick = () => {
    gameStarted = true;
    overlay.style.display = "none";
    loop();
};

function performAttack() {
    p.isAttacking = 10;
    const range = p.weaponLvl === 1 ? 120 : 40;
    const damage = p.weaponLvl === 1 ? 10 : 0;

    if (boss.alive) {
        const dx = (p.x + (p.dir * range)) - boss.x;
        const dy = p.y - boss.y;
        if (Math.hypot(dx, dy) < 60) {
            boss.hp -= damage;
            if (boss.hp <= 0) boss.alive = false;
        }
    }
}

function update() {
    // Dash e Movimento
    let s = p.speed;
    if (keys['ShiftLeft'] && p.dash <= 0) p.dash = 15;
    if (p.dash > 0) { s = 20; p.dash--; }

    if (keys['KeyW']) p.y -= s;
    if (keys['KeyS']) p.y += s;
    if (keys['KeyA']) { p.x -= s; p.dir = -1; }
    if (keys['KeyD']) { p.x += s; p.dir = 1; }

    if (keys['Space'] && p.isAttacking <= 0) { performAttack(); keys['Space'] = false; }
    if (p.isAttacking > 0) p.isAttacking--;

    // Interação com Mestre
    if (keys['KeyE'] && Math.hypot(p.x - 400, p.y - 150) < 60) {
        p.weaponLvl = 1;
    }
}

function draw() {
    ctx.fillStyle = "#000510";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Desenha NPCs
    npcs.forEach(n => {
        if (sprites.master && n.id === 'mestre') ctx.drawImage(sprites.master, n.x-25, n.y-25, 50, 50);
        else if (sprites.ninja) ctx.drawImage(sprites.ninja, n.x-25, n.y-25, 50, 50);
        
        if (Math.hypot(p.x - n.x, p.y - n.y) < 80) {
            ctx.fillStyle = "white";
            ctx.fillText(n.msg, n.x - 50, n.y - 40);
        }
    });

    // Boss
    if (boss.alive) {
        if (sprites.enemy) ctx.drawImage(sprites.enemy, boss.x-40, boss.y-40, 80, 80);
        ctx.fillStyle = "red";
        ctx.fillRect(boss.x-40, boss.y-60, (boss.hp/100)*80, 5);
    } else if (sprites.logo) {
        ctx.drawImage(sprites.logo, canvas.width/2 - 100, canvas.height/2 - 100, 200, 200);
    }

    // Player e Espada
    ctx.save();
    ctx.translate(p.x, p.y);
    if (p.dir === -1) ctx.scale(-1, 1);
    
    // Desenha Heroi
    if (sprites.hero) ctx.drawImage(sprites.hero, -25, -25, 50, 50);

    // Efeito Espada
    if (p.isAttacking > 0) {
        ctx.strokeStyle = p.weaponLvl === 1 ? "#0ff" : "#640";
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.arc(20, 0, p.weaponLvl === 1 ? 50 : 20, -1, 1);
        ctx.stroke();
    }
    ctx.restore();

    // UI
    ctx.fillStyle = "#0ff";
    ctx.font = "bold 16px Arial";
    ctx.fillText(`ARMA: ${p.weaponLvl === 1 ? "LAMINA VMZ" : "GRAVETO"}`, 20, 30);
}

function loop() {
    update();
    draw();
    if (gameStarted) requestAnimationFrame(loop);
}
</script>
</body>
</html>
