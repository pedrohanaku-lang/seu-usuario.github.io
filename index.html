<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Samurai Soul Fix</title>
<style>
    body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; }
    canvas { background: #050505; border: 2px solid #0f0; display: none; }
    #menu, #cartas, #game-over { position: absolute; background: rgba(0,0,0,0.9); border: 2px solid #0f0; padding: 30px; text-align: center; z-index: 10; }
    button { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; border: 1px solid #0f0; background: transparent; color: #0f0; text-transform: uppercase; }
    button:hover { background: #0f0; color: #000; }
    .cartao { width: 180px; border: 1px solid #0f0; padding: 10px; margin: 10px; cursor: pointer; display: inline-block; }
</style>
</head>
<body>

<canvas id="c" width="800" height="600"></canvas>

<div id="menu">
    <h1 style="color: #0f0;">SAMURAI SOUL</h1>
    <p>WASD: Mover | Mouse: Atacar | E: Trocar Arma | G: Especial</p>
    <button onclick="startGame()">INICIAR SISTEMA</button>
</div>

<div id="cartas" style="display:none"></div>

<div id="game-over" style="display:none">
    <h1 style="color: red;">CONEX√ÉO PERDIDA</h1>
    <button onclick="location.reload()">RECONECTAR</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const W=800, H=600;

let player, enemies, bullets, particles, gameActive = false;
let stage = 1, kills = 0, xp = 0, xpNext = 5, special = 0;
let keys = {};
let mouse = {x:0, y:0};

// Eventos
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
canvas.addEventListener("mousemove", e => {
    const r = canvas.getBoundingClientRect();
    mouse.x = e.clientX - r.left;
    mouse.y = e.clientY - r.top;
});
canvas.addEventListener("mousedown", () => {
    if(!gameActive) return;
    if(player.weapon === "gun") shoot(); else slash();
});

function startGame() {
    document.getElementById("menu").style.display = "none";
    canvas.style.display = "block";
    initGame();
    gameActive = true;
    loop();
}

function initGame() {
    player = { x: W/2, y: H/2, speed: 4, hp: 100, weapon: "sword", size: 30 };
    enemies = [];
    bullets = [];
    particles = [];
    spawnWave();
}

function spawnWave() {
    for(let i=0; i < 3 + stage; i++) {
        enemies.push({
            x: Math.random() * W,
            y: Math.random() * H,
            hp: 2 + stage,
            speed: 1 + Math.random()
        });
    }
}

function shoot() {
    let angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    bullets.push({
        x: player.x, y: player.y,
        vx: Math.cos(angle) * 7,
        vy: Math.sin(angle) * 7
    });
}

function slash() {
    let dist = Math.hypot(mouse.x - player.x, mouse.y - player.y);
    if(dist < 100) {
        enemies.forEach((en, i) => {
            if(Math.hypot(en.x - mouse.x, en.y - mouse.y) < 60) {
                en.hp -= 2;
                special = Math.min(100, special + 5);
            }
        });
    }
}

function update() {
    if(!gameActive) return;

    // Movimento
    if(keys['w'] && player.y > 0) player.y -= player.speed;
    if(keys['s'] && player.y < H) player.y += player.speed;
    if(keys['a'] && player.x > 0) player.x -= player.speed;
    if(keys['d'] && player.x < W) player.x += player.speed;

    if(keys['e']) { player.weapon = player.weapon === "sword" ? "gun" : "sword"; keys['e'] = false; }
    if(keys['g'] && special >= 100) { special = 0; enemies = []; spawnWave(); }

    // Inimigos
    enemies.forEach((en, i) => {
        let angle = Math.atan2(player.y - en.y, player.x - en.x);
        en.x += Math.cos(angle) * en.speed;
        en.y += Math.sin(angle) * en.speed;

        if(Math.hypot(player.x - en.x, player.y - en.y) < 20) {
            player.hp -= 0.1;
            if(player.hp <= 0) { gameActive = false; document.getElementById("game-over").style.display="block"; }
        }

        if(en.hp <= 0) {
            enemies.splice(i, 1);
            kills++; xp++;
            if(xp >= xpNext) levelUp();
        }
    });

    // Bullets
    bullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        enemies.forEach((en, ei) => {
            if(Math.hypot(en.x - b.x, en.y - b.y) < 20) {
                en.hp -= 1;
                bullets.splice(i, 1);
            }
        });
    });

    if(enemies.length === 0) { stage++; spawnWave(); }
}

function levelUp() {
    xp = 0; xpNext += 5;
    player.hp = 100;
}

function draw() {
    ctx.fillStyle = "#000";
    ctx.fillRect(0,0,W,H);

    // Inimigos
    ctx.fillStyle = "red";
    enemies.forEach(en => ctx.fillRect(en.x-10, en.y-10, 20, 20));

    // Player
    ctx.fillStyle = "#0f0";
    ctx.fillRect(player.x-15, player.y-15, 30, 30);
    
    // Mira da espada
    if(player.weapon === "sword") {
        ctx.strokeStyle = "rgba(0,255,0,0.3)";
        ctx.beginPath();
        ctx.arc(player.x, player.y, 80, 0, Math.PI*2);
        ctx.stroke();
    }

    // Tiros
    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 5, 5));

    // UI
    ctx.fillStyle = "#0f0";
    ctx.fillText(`HP: ${Math.floor(player.hp)} | KILLS: ${kills} | STAGE: ${stage}`, 20, 20);
    ctx.fillText(`ARMA: ${player.weapon.toUpperCase()}`, 20, 40);
    
    // Especial Bar
    ctx.strokeStyle = "#0f0";
    ctx.strokeRect(W-120, 10, 100, 10);
    ctx.fillRect(W-120, 10, special, 10);
}

function loop() {
    if(gameActive) {
        update();
        draw();
    }
    requestAnimationFrame(loop);
}
</script>
</body>
</html>
