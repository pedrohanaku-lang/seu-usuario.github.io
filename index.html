<!DOCTYPE html>
<html>
<head>
    <title>Time Zueira RPG - Anti-Blackscreen</title>
    <script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>
</head>
<body style="margin:0; background:#000;">
<script>
// 1. Inicialização Forçada
const k = kaboom({
    background: [20, 20, 30],
    scale: 1.5,
})

// 2. Carregamento de Sprites (Tente carregar, mas não trave o jogo)
loadSprite("hero", "_Hugkw.gif")
loadSprite("mestre", "XSuwrQ.gif")
loadSprite("ninja", "Ru5PS2.gif")
loadSprite("mago", "KFBLh9.gif")
loadSprite("inimigo", "sRNxiP.gif")
loadSprite("logo", "image_da46a4.png")

scene("game", () => {
    // Sistema de Dano e Armas
    let armaNivel = 0 // 0 = Inútil, 1 = Lâmina VMZ

    // Jogador
    const player = add([
        sprite("hero"), 
        pos(100, 100),
        area(),
        body(),
        anchor("center"),
        {
            speed: 200,
            isDashing: false,
        }
    ])

    // Espada Visual (seguindo o player)
    const sword = add([
        rect(5, 30),
        anchor("bot"),
        pos(player.pos),
        color(150, 150, 150),
        opacity(0), // Começa escondida
    ])

    // NPCs e Boss
    const mestre = add([
        sprite("mestre"),
        pos(300, 150),
        area(),
        anchor("center"),
        "npc"
    ])

    const boss = add([
        sprite("inimigo"),
        pos(500, 350),
        area(),
        health(100),
        anchor("center"),
        "enemy"
    ])

    // --- MOVESET (DASH E ATAQUE) ---

    // ATAQUE (ESPAÇO)
    onKeyPress("space", () => {
        sword.opacity = 1
        sword.pos = player.pos.add(player.flipX ? -15 : 15, 0)
        
        // Animação de corte
        tween(0, 120, 0.1, (v) => sword.angle = player.flipX ? -v : v, easings.easeOutQuad)
        
        wait(0.15, () => {
            sword.opacity = 0
            sword.angle = 0
        })

        // Lógica de Dano
        if (armaNivel === 1) {
            if (player.pos.dist(boss.pos) < 70) {
                boss.hurt(20)
                shake(10)
                addKaboom(boss.pos)
            }
        } else {
            // Se a arma for inútil (Nível 0)
            add([
                text("DANO ZERO", { size: 10 }),
                pos(player.pos.add(0, -40)),
                lifespan(0.3),
                move(UP, 100)
            ])
        }
    })

    // DASH (SHIFT)
    onKeyPress("shift", () => {
        if (player.isDashing) return
        player.isDashing = true
        player.speed = 800
        
        // Efeito visual de rastro (Ghost)
        const ghost = add([
            sprite("hero"),
            pos(player.pos),
            opacity(0.4),
            lifespan(0.1)
        ])

        wait(0.1, () => {
            player.speed = 200
            player.isDashing = false
        })
    })

    // --- INTERAÇÃO (E) ---
    onKeyPress("e", () => {
        if (player.pos.dist(mestre.pos) < 60) {
            armaNivel = 1
            sword.color = rgb(0, 255, 255) // A espada fica azul neon
            add([
                text("LÂMINA VMZ OBTIDA!", { size: 20 }),
                pos(center()),
                anchor("center"),
                lifespan(2),
                fixed()
            ])
        }
    })

    // --- MOVIMENTAÇÃO ---
    onKeyDown("a", () => { player.move(-player.speed, 0); player.flipX = true })
    onKeyDown("d", () => { player.move(player.speed, 0); player.flipX = false })
    onKeyDown("w", () => player.move(0, -player.speed))
    onKeyDown("s", () => player.move(0, player.speed))

    // Câmera e Update
    player.onUpdate(() => {
        camPos(player.pos)
        sword.pos = player.pos.add(player.flipX ? -10 : 10, 5)
    })

    boss.onDeath(() => {
        destroy(boss)
        add([
            sprite("logo"),
            pos(player.pos),
            anchor("center")
        ])
        add([
            text("BOSS ELIMINADO", { size: 30 }),
            pos(player.pos.add(0, 100)),
            anchor("center")
        ])
    })
})

// Inicia o jogo imediatamente, sem esperar carregamento infinito
go("game")
</script>
</body>
</html>
