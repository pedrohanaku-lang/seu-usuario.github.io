<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Samurai Soul: Cyber Roguelike</title>
<style>
    body { margin: 0; background: #050505; display: flex; justify-content: center; align-items: center; height: 100vh; color: #00ffcc; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
    canvas { background: #0a0a0a; border: 2px solid #00ffcc; box-shadow: 0 0 20px rgba(0, 255, 204, 0.3); cursor: crosshair; }
    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    #menu, #creditos, #cartas, #game-over { position: absolute; background: rgba(0,0,0,0.9); border: 2px solid #00ffcc; padding: 30px; text-align: center; pointer-events: auto; z-index: 100; }
    #cartas { display: none; gap: 20px; flex-direction: row; }
    .cartao { width: 180px; border: 1px solid #00ffcc; padding: 20px; background: #111; cursor: pointer; transition: 0.3s; }
    .cartao:hover { background: #00ffcc; color: #000; transform: translateY(-10px); box-shadow: 0 0 15px #00ffcc; }
    button { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; border: 1px solid #00ffcc; background: transparent; color: #00ffcc; text-transform: uppercase; transition: 0.3s; }
    button:hover { background: #00ffcc; color: #000; }
    .stat-bar { position: absolute; bottom: 20px; left: 20px; width: 250px; height: 15px; border: 1px solid #00ffcc; }
    .bar-fill { height: 100%; width: 0%; background: #00ffcc; transition: 0.2s; }
</style>
</head>
<body>

<canvas id="c" width="1000" height="700"></canvas>

<div id="menu">
    <h1 style="font-size: 40px; text-shadow: 0 0 10px #00ffcc;">SAMURAI SOUL</h1>
    <p>Use WASD para mover | Mouse Esquerdo: Atacar | E: Trocar Arma | G: Especial</p>
    <button onclick="startGame()">INICIAR PROTOCOLO</button><br>
    <button onclick="showCredits()">CRÉDITOS</button>
</div>

<div id="creditos" style="display:none">
    <h2>ARQUIVOS DO SISTEMA</h2>
    <p>Desenvolvimento Original: Hanako & Barros</p>
    <p>Refinamento: Gemini Core</p>
    <button onclick="backMenu()">VOLTAR</button>
</div>

<div id="cartas"></div>

<div id="game-over" style="display:none">
    <h1 style="color: #ff3333;">CONEXÃO PERDIDA</h1>
    <p id="final-score"></p>
    <button onclick="location.reload()">RECONECTAR</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const W=1000, H=700, PLAYER_SIZE=35;

let player, enemies, playerBullets, enemyBullets, particles;
let keys={}, mouse={x:0, y:0};
let gameActive=false, showingCards=false;
let stage=1, kills=0, xp=0, xpNextLevel=5;
let specialBar=0;
const maxSpecial=100;

// ---------------- CLASSES ----------------
class Particle {
    constructor(x,y,color) {
        this.x=x; this.y=y; this.color=color;
        this.v={x:(Math.random()-0.5)*5, y:(Math.random()-0.5)*5};
        this.life=1.0;
    }
    draw() {
        this.life -= 0.02;
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, 4, 4);
        ctx.globalAlpha = 1;
        this.x += this.v.x; this.y += this.v.y;
    }
}

// ---------------- SETUP ----------------
function startGame(){
    document.getElementById("menu").style.display="none";
    canvas.style.display="block";
    resetRun();
    gameActive=true;
}

function resetRun(){
    player = {
        x: W/2, y: H/2, speed: 5, 
        hp: 100, maxHp: 100, 
        weapon: "sword", // Começa com espada que é mais samurai
        dashCooldown: 0
    };
    enemies=[]; playerBullets=[]; enemyBullets=[]; particles=[];
    stage=1; kills=0; xp=0; specialBar=0;
    spawnWave();
}

// ---------------- INPUTS ----------------
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);
window.addEventListener("mousemove", e => {
    const r = canvas.getBoundingClientRect();
    mouse.x = e.clientX - r.left;
    mouse.y = e.clientY - r.top;
});
canvas.addEventListener("mousedown", e => {
    if(!gameActive) return;
    if(player.weapon === "gun") shoot();
    else swordAttack();
});

function shoot() {
    playerBullets.push({
        x: player.x+PLAYER_SIZE/2, y: player.y+PLAYER_SIZE/2,
        vx: (mouse.x - (player.x+PLAYER_SIZE/2)) * 0.1,
        vy: (mouse.y - (player.y+PLAYER_SIZE/2)) * 0.1,
        life: 100
    });
}

function swordAttack() {
    // Efeito visual de corte
    for(let i=0; i<10; i++) particles.push(new Particle(mouse.x, mouse.y, "#00ffcc"));
    
    enemies.forEach((en, index) => {
        let dist = Math.hypot(en.x - mouse.x, en.y - mouse.y);
        if(dist < 80) {
            damageEnemy(index, 2);
            specialBar = Math.min(maxSpecial, specialBar + 5);
        }
    });
}

// ---------------- LOGICA ----------------
function damageEnemy(index, dmg) {
    let en = enemies[index];
    en.hp -= dmg;
    for(let i=0; i<3; i++) particles.push(new Particle(en.x, en.y, "#ff3333"));
    if(en.hp <= 0) {
        enemies.splice(index, 1);
        kills++;
        xp++;
        if(xp >= xpNextLevel) levelUp();
    }
}

function levelUp() {
    gameActive = false;
    xp = 0;
    xpNextLevel += 5;
    showShop();
}

function showShop() {
    const div = document.getElementById("cartas");
    div.style.display = "flex";
    div.innerHTML = "";
    const options = [
        {t: "NANO-REPARO", d: "+20 HP", f: () => player.hp = Math.min(player.maxHp, player.hp + 20)},
        {t: "SOBRECARGA", d: "+1 Velocidade", f: () => player.speed += 1},
        {t: "LÂMINA LONGA", d: "Ataque em área maior", f: () => { /* lógica de range */ }}
    ];
    options.forEach(opt => {
        let c = document.createElement("div");
        c.className = "cartao";
        c.innerHTML = `<h3>${opt.t}</h3><p>${opt.d}</p>`;
        c.onclick = () => { opt.f(); div.style.display="none"; gameActive=true; checkWave(); };
        div.appendChild(c);
    });
}

function spawnWave() {
    for(let i=0; i < 3 + stage; i++) {
        enemies.push({
            x: Math.random() > 0.5 ? 0 : W,
            y: Math.random() * H,
            hp: 3 + stage,
            speed: 1.5 + (Math.random()),
            w: 30, h: 30
        });
    }
}

function checkWave() {
    if(enemies.length === 0) {
        stage++;
        spawnWave();
    }
}

function update() {
    if(!gameActive) return;

    // Movimento
    if(keys["w"]) player.y -= player.speed;
    if(keys["s"]) player.y += player.speed;
    if(keys["a"]) player.x -= player.speed;
    if(keys["d"]) player.x += player.speed;

    // Inimigos perseguem
    enemies.forEach(en => {
        let dx = (player.x + PLAYER_SIZE/2) - en.x;
        let dy = (player.y + PLAYER_SIZE/2) - en.y;
        let dist = Math.hypot(dx, dy);
        en.x += (dx/dist) * en.speed;
        en.y += (dy/dist) * en.speed;

        if(dist < 30) {
            player.hp -= 0.2;
            if(player.hp <= 0) endGame();
        }
    });

    // Balas
    playerBullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        b.life--;
        if(b.life <= 0) playerBullets.splice(i,1);
        enemies.forEach((en, ei) => {
            if(Math.hypot(en.x - b.x, en.y - b.y) < 20) {
                damageEnemy(ei, 1);
                playerBullets.splice(i,1);
            }
        });
    });

    if(keys["e"]) { player.weapon = player.weapon === "sword" ? "gun" : "sword"; keys["e"]=false; }
    if(keys["g"] && specialBar >= maxSpecial) {
        specialBar = 0;
        enemies.forEach((e, i) => damageEnemy(i, 10));
    }
}

function endGame() {
    gameActive = false;
    document.getElementById("game-over").style.display = "block";
    document.getElementById("final-score").innerText = `Kills: ${kills} | Estágio: ${stage}`;
}

function draw() {
    ctx.fillStyle = "#0a0a0a";
    ctx.fillRect(0,0,W,H);

    // Partículas
    particles.forEach((p, i) => {
        p.draw();
        if(p.life <= 0) particles.splice(i, 1);
    });

    // Player
    ctx.shadowBlur = 15;
    ctx.shadowColor = "#00ffcc";
    ctx.fillStyle = "#00ffcc";
    ctx.fillRect(player.x, player.y, PLAYER_SIZE, PLAYER_SIZE);
    
    // Inimigos
    ctx.shadowColor = "#ff3333";
    ctx.fillStyle = "#ff3333";
    enemies.forEach(en => ctx.fillRect(en.x, en.y, en.w, en.h));
    
    // Balas
    ctx.shadowColor = "#00ffcc";
    ctx.fillStyle = "#00ffcc";
    playerBullets.forEach(b => ctx.fillRect(b.x, b.y, 6, 6));

    // UI
    ctx.shadowBlur = 0;
    ctx.fillStyle = "#fff";
    ctx.font = "14px Courier New";
    ctx.fillText(`HP: ${Math.ceil(player.hp)}`, 20, 30);
    ctx.fillText(`KILLS: ${kills}`, 20, 50);
    ctx.fillText(`STAGE: ${stage}`, 20, 70);
    ctx.fillText(`ARMA: ${player.weapon.toUpperCase()}`, 20, 90);
    
    // XP Bar
    ctx.strokeStyle = "#00ffcc";
    ctx.strokeRect(W/2 - 100, 20, 200, 10);
    ctx.fillStyle = "#00ffcc";
    ctx.fillRect(W/2 - 100, 20, (xp/xpNextLevel)*200, 10);

    // Special Bar
    ctx.strokeStyle = "#ff0";
    ctx.strokeRect(W - 120, H - 30, 100, 10);
    ctx.fillStyle = "#ff0";
    ctx.fillRect(W - 120, H - 30, (specialBar/maxSpecial)*100, 10);
    if(specialBar >= maxSpecial) ctx.fillText("ESPECIAL PRONTO [G]", W - 150, H - 40);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();

// Funções de Menu
function showCredits(){ document.getElementById("menu").style.display="none"; document.getElementById("creditos").style.display="block"; }
function backMenu(){ document.getElementById("creditos").style.display="none"; document.getElementById("menu").style.display="block"; }

</script>
</body>
</html>
