<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Evite as Balas</title>

<style>
body{
    margin:0;
    background:#111;
    color:#0f0;
    font-family:Arial;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

canvas{
    background:#000;
    border:3px solid #0f0;
    display:none;
}

#menu,#creditos,#cartas{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#000;
    border:2px solid #0f0;
    padding:30px;
    text-align:center;
}

#cartas{
    display:none;
    gap:15px;
}

.cartao{
    background:#111;
    border:2px solid #0f0;
    padding:15px;
    width:140px;
    cursor:pointer;
}

.cartao:hover{
    background:#0f0;
    color:#000;
}

button{
    background:#0f0;
    color:#000;
    border:none;
    padding:12px 25px;
    font-size:18px;
    cursor:pointer;
    margin:10px;
}
</style>
</head>
<body>

<canvas id="c" width="800" height="600"></canvas>

<div id="menu">
    <h1>EVITE AS BALAS</h1>
    <button onclick="start()">JOGAR</button>
    <button onclick="showCreditos()">CRÉDITOS</button>
</div>

<div id="creditos" style="display:none">
    <h2>CRÉDITOS</h2>
    <p>Scripter: Hanako</p>
    <p>Design: Barros</p>
    <button onclick="back()">VOLTAR</button>
</div>

<div id="cartas"></div>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");

let player;
let enemies = [];
let bulletPlayer = [];
let bulletEnemy = [];

let keys = {};
let mouseX = 0;
let mouseY = 0;

let gameActive = false;
let showingCards = false;

let killCount = 0;
let score = 0;

let maxLives = 3;
let currentLives = 3;

let doubleShot = false;
let swordRange = 70;

function start(){
    document.getElementById("menu").style.display="none";
    c.style.display="block";
    resetGame();
    gameActive = true;
    spawnEnemy();
}

function resetGame(){
    player = {x:100,y:300,w:30,h:30,speed:5};
    enemies = [];
    bulletPlayer = [];
    bulletEnemy = [];
    killCount = 0;
    score = 0;
    maxLives = 3;
    currentLives = 3;
    doubleShot = false;
    swordRange = 70;
}

function showCreditos(){
    document.getElementById("menu").style.display="none";
    document.getElementById("creditos").style.display="block";
}

function back(){
    document.getElementById("creditos").style.display="none";
    document.getElementById("menu").style.display="block";
    c.style.display="none";
}

window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

c.addEventListener("mousemove",e=>{
    const r=c.getBoundingClientRect();
    mouseX=e.clientX-r.left;
    mouseY=e.clientY-r.top;
});

c.oncontextmenu=e=>e.preventDefault();
c.addEventListener("mousedown",e=>{
    if(e.button===2) shoot();
});

class Bullet{
    constructor(x,y,tx,ty,speed,color){
        this.x=x;
        this.y=y;
        let dx=tx-x,dy=ty-y;
        let d=Math.hypot(dx,dy)||1;
        this.vx=dx/d*speed;
        this.vy=dy/d*speed;
        this.color=color;
    }
    update(){
        this.x+=this.vx;
        this.y+=this.vy;
    }
    draw(){
        ctx.fillStyle=this.color;
        ctx.fillRect(this.x-4,this.y-4,8,8);
    }
    off(){
        return this.x<-20||this.x>820||this.y<-20||this.y>620;
    }
}

function shoot(){
    bulletPlayer.push(
        new Bullet(
            player.x+15,player.y+15,
            mouseX,mouseY,
            7,"#f44"
        )
    );

    if(doubleShot){
        setTimeout(()=>{
            bulletPlayer.push(
                new Bullet(
                    player.x+15,player.y+15,
                    mouseX,mouseY,
                    7,"#f44"
                )
            );
        },80);
    }
}

function sword(){
    for(let i=enemies.length-1;i>=0;i--){
        let e=enemies[i];
        let d=Math.hypot(e.x-player.x,e.y-player.y);
        if(d<swordRange){
            killEnemy(i);
            return;
        }
    }

    for(let i=bulletEnemy.length-1;i>=0;i--){
        let b=bulletEnemy[i];
        let d=Math.hypot(b.x-player.x,b.y-player.y);
        if(d<swordRange+20) bulletEnemy.splice(i,1);
    }
}

function spawnEnemy(){
    enemies.push({
        x:Math.random()*760,
        y:Math.random()*560,
        w:30,h:30,
        vx:Math.random()*2-1,
        vy:Math.random()*2-1,
        shootTimer:0,
        shootInterval:60
    });
}

function spawnBoss(){
    enemies.push({
        x:320,y:40,
        w:160,h:160,
        vx:0,vy:1,
        shootTimer:0,
        shootInterval:25,
        isBoss:true,
        hp:100
    });
}

function killEnemy(i){
    let e=enemies.splice(i,1)[0];
    killCount++;

    if(e.isBoss){
        openCards();
        return;
    }

    score+=10;

    if(killCount%20===0) spawnBoss();
    else spawnEnemy();
}

function openCards(){
    showingCards=true;
    gameActive=false;

    const cartasDiv=document.getElementById("cartas");
    cartasDiv.innerHTML="";
    cartasDiv.style.display="flex";

    const cartas=[
        "Vida máxima +1",
        "Tiro duplo",
        "Espada maior"
    ];

    cartas.forEach((t,i)=>{
        let d=document.createElement("div");
        d.className="cartao";
        d.textContent=t;
        d.onclick=()=>{
            if(i===0){maxLives++;currentLives++;}
            if(i===1){doubleShot=true;}
            if(i===2){swordRange=110;}
            cartasDiv.style.display="none";
            showingCards=false;
            gameActive=true;
        };
        cartasDiv.appendChild(d);
    });
}

function update(){

    if(!gameActive) return;

    if(keys[" "]) sword();

    if(keys.w||keys.ArrowUp) player.y-=player.speed;
    if(keys.s||keys.ArrowDown) player.y+=player.speed;
    if(keys.a||keys.ArrowLeft) player.x-=player.speed;
    if(keys.d||keys.ArrowRight) player.x+=player.speed;

    player.x=Math.max(0,Math.min(770,player.x));
    player.y=Math.max(0,Math.min(570,player.y));

    enemies.forEach(e=>{
        e.x+=e.vx;
        e.y+=e.vy;

        e.shootTimer++;

        if(e.shootTimer>=e.shootInterval){

            if(e.isBoss){
                let cx=e.x+80,cy=e.y+80;
                for(let k=0;k<8;k++){
                    let a=k*Math.PI/4;
                    let tx=cx+Math.cos(a)*400;
                    let ty=cy+Math.sin(a)*400;
                    bulletEnemy.push(new Bullet(cx,cy,tx,ty,4,"#f0f"));
                }
            }else{
                bulletEnemy.push(
                    new Bullet(
                        e.x+15,e.y+15,
                        player.x+15,player.y+15,
                        5,"#44f"
                    )
                );
            }

            e.shootTimer=0;
        }
    });

    updateBullets(bulletPlayer,true);
    updateBullets(bulletEnemy,false);
}

function updateBullets(arr,isPlayer){

    for(let i=arr.length-1;i>=0;i--){
        let b=arr[i];
        b.update();

        if(b.off()){
            arr.splice(i,1);
            continue;
        }

        if(!isPlayer){
            let d=Math.hypot(
                b.x-(player.x+15),
                b.y-(player.y+15)
            );

            if(d<20){
                arr.splice(i,1);
                currentLives--;
                if(currentLives<=0) gameOver();
            }
        }

        if(isPlayer){
            for(let j=enemies.length-1;j>=0;j--){
                let e=enemies[j];
                let d=Math.hypot(
                    b.x-(e.x+e.w/2),
                    b.y-(e.y+e.h/2)
                );
                if(d<25){
                    arr.splice(i,1);

                    if(e.isBoss){
                        e.hp--;
                        if(e.hp<=0) killEnemy(j);
                    }else{
                        killEnemy(j);
                    }
                    break;
                }
            }
        }
    }
}

function gameOver(){
    gameActive=false;
}

function draw(){

    ctx.clearRect(0,0,800,600);

    ctx.fillStyle="#0f0";
    ctx.fillRect(player.x,player.y,30,30);

    enemies.forEach(e=>{
        ctx.fillStyle=e.isBoss?"#400":"#f0f";
        ctx.fillRect(e.x,e.y,e.w,e.h);

        if(e.isBoss){
            ctx.fillStyle="#fff";
            ctx.fillRect(e.x,e.y-10,160,5);
            ctx.fillStyle="red";
            ctx.fillRect(e.x,e.y-10,160*(e.hp/100),5);
        }
    });

    bulletPlayer.forEach(b=>b.draw());
    bulletEnemy.forEach(b=>b.draw());

    ctx.fillStyle="#0f0";
    ctx.fillText("Score: "+score,10,20);
    ctx.fillText("Kills: "+killCount,10,40);
    ctx.fillText("Vidas: "+currentLives,10,60);

    if(!gameActive && !showingCards){
        ctx.fillStyle="rgba(0,0,0,0.8)";
        ctx.fillRect(0,0,800,600);
        ctx.fillStyle="red";
        ctx.font="40px Arial";
        ctx.fillText("GAME OVER",300,300);
    }
}

function loop(){
    requestAnimationFrame(loop);
    update();
    draw();
}

loop();
</script>
</body>
</html>

