<!DOCTYPE html>
<html>
<head>
    <title>Time Zueira RPG</title>
    <script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>
</head>
<body style="margin:0; background:#000;">
<script>
// 1. Inicialização direta
const k = kaboom({
    background: [10, 10, 20],
    scale: 2
})

// 2. Carregar Sprites (Nomes fixos para evitar erro de referência)
loadSprite("hero", "_Hugkw.gif")
loadSprite("mestre", "XSuwrQ.gif")
loadSprite("ninja", "Ru5PS2.gif")
loadSprite("inimigo", "sRNxiP.gif")
loadSprite("logo", "image_da46a4.png")

scene("main", () => {

    // Jogador
    const player = add([
        sprite("hero"),
        pos(100, 100),
        area(),
        body(),
        anchor("center"),
        { 
            arma: "fraca",
            speed: 160 
        }
    ])

    // Visual da Espada (Simples, anexada ao player)
    const sword = player.add([
        rect(5, 20),
        pos(15, 0),
        color(100, 100, 100),
        anchor("bot"),
        rotate(0)
    ])

    // --- NPCs e Inimigos ---
    
    // Mestre que dá a arma
    add([
        sprite("mestre"),
        pos(300, 100),
        area(),
        "npc_mestre"
    ])

    // Inimigo
    const boss = add([
        sprite("inimigo"),
        pos(400, 300),
        area(),
        health(50),
        "enemy"
    ])

    // --- Lógica de Combate ---
    
    onKeyPress("space", () => {
        // Animação da espada
        tween(0, 90, 0.1, (v) => sword.angle = v, easings.easeOutQuad)
        wait(0.1, () => sword.angle = 0)

        // Dano
        if (player.arma === "forte") {
            const targets = get("enemy")
            targets.forEach(t => {
                if (player.pos.dist(t.pos) < 60) {
                    t.hurt(10)
                    shake(5)
                }
            })
        } else {
            add([
                text("Dano 0 - Fale com o mestre", { size: 12 }),
                pos(player.pos),
                lifespan(0.5),
                move(UP, 50)
            ])
        }
    })

    // --- Interação ---
    
    onKeyPress("e", () => {
        if (player.pos.dist(get("npc_mestre")[0].pos) < 50) {
            player.arma = "forte"
            sword.color = rgb(0, 255, 255) // Espada brilha
            add([
                text("VOCÊ RECEBEU A LÂMINA VMZ!", { size: 16 }),
                pos(center()),
                anchor("center"),
                lifespan(2)
            ])
        }
    })

    // --- Controles ---
    
    onKeyDown("left", () => { player.move(-player.speed, 0); player.flipX = true })
    onKeyDown("right", () => { player.move(player.speed, 0); player.flipX = false })
    onKeyDown("up", () => { player.move(0, -player.speed) })
    onKeyDown("down", () => { player.move(0, player.speed) })

    // Câmera segue o herói
    onUpdate(() => {
        camPos(player.pos)
    })

    // Vitória
    boss.onDeath(() => {
        destroy(boss)
        add([
            sprite("logo"),
            pos(center()),
            anchor("center"),
            fixed()
        ])
    })

    // HUD Fixo
    add([
        text("Aperte E perto do Mestre | ESPAÇO para atacar", { size: 10 }),
        pos(10, 10),
        fixed()
    ])
})

go("main")
</script>
</body>
</html>
