<!DOCTYPE html>
<html>
<head>
    <title>TZ RPG - Estável</title>
    <script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>
</head>
<body style="margin:0; background:#000;">
<script>
// 1. Inicialização
kaboom({
    background: [5, 5, 10],
    scale: 2,
    debug: true // Ativa modo de erro na tela para sabermos o que houve
})

// 2. Carregamento com tratamento de erro
loadSprite("hero", "_Hugkw.gif")
loadSprite("mestre", "XSuwrQ.gif")
loadSprite("ninja", "Ru5PS2.gif")
loadSprite("inimigo", "sRNxiP.gif")
loadSprite("logo", "image_da46a4.png")

// Essa função "wait" garante que o motor gráfico processe as imagens
wait(0.1, () => {

    scene("main", () => {
        // Criar o Player apenas se o sprite existir
        const player = add([
            sprite("hero"),
            pos(80, 80),
            area(),
            body(),
            anchor("center"),
            { 
                armaForte: false,
                speed: 150 
            }
        ])

        // NPCs
        const mestre = add([
            sprite("mestre"),
            pos(250, 100),
            area(),
            anchor("center"),
            "npc"
        ])

        const boss = add([
            sprite("inimigo"),
            pos(300, 250),
            area(),
            health(30),
            anchor("center"),
            "enemy"
        ])

        // --- SISTEMA DE COMBATE (MOVESET) ---
        onKeyPress("space", () => {
            // Efeito visual do ataque
            const atq = add([
                rect(player.armaForte ? 60 : 20, 2),
                pos(player.pos.add(player.flipX ? -30 : 30, 0)),
                anchor("center"),
                color(player.armaForte ? rgb(0, 255, 255) : rgb(150, 150, 150)),
                lifespan(0.1),
            ])

            // Lógica de Dano
            if (player.armaForte) {
                if (player.pos.dist(boss.pos) < 70) {
                    boss.hurt(10)
                    shake(10)
                    add([
                        text("HIT!", {size: 10}),
                        pos(boss.pos),
                        lifespan(0.3),
                        move(UP, 100)
                    ])
                }
            } else {
                // Se estiver com graveto, não dá dano
                shake(1)
            }
        })

        // --- INTERAÇÃO ---
        onKeyPress("e", () => {
            if (player.pos.dist(mestre.pos) < 50) {
                player.armaForte = true
                add([
                    text("LÂMINA VMZ EQUIPADA!", { size: 12 }),
                    pos(center()),
                    anchor("center"),
                    lifespan(2),
                    fixed()
                ])
            }
        })

        // --- CONTROLES ---
        onKeyDown("left", () => { player.move(-player.speed, 0); player.flipX = true })
        onKeyDown("right", () => { player.move(player.speed, 0); player.flipX = false })
        onKeyDown("up", () => player.move(0, -player.speed))
        onKeyDown("down", () => player.move(0, player.speed))

        // Câmera
        player.onUpdate(() => {
            camPos(player.pos)
            if (boss.hp() <= 0) {
                destroy(boss)
                go("win")
            }
        })
    })

    scene("win", () => {
        add([
            sprite("logo"),
            pos(center()),
            anchor("center"),
            scale(0.5)
        ])
        add([
            text("BOSS DERROTADO - TIME ZUEIRA", { size: 14 }),
            pos(center().add(0, 100)),
            anchor("center")
        ])
    })

    go("main")
})
</script>
</body>
</html>
